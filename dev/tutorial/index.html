<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · RestClient.jl</title><meta name="title" content="Tutorial · RestClient.jl"/><meta property="og:title" content="Tutorial · RestClient.jl"/><meta property="twitter:title" content="Tutorial · RestClient.jl"/><meta name="description" content="Documentation for RestClient.jl."/><meta property="og:description" content="Documentation for RestClient.jl."/><meta property="twitter:description" content="Documentation for RestClient.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RestClient.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Basic-setup"><span>Basic setup</span></a></li><li><a class="tocitem" href="#Defining-API-types"><span>Defining API types</span></a></li><li><a class="tocitem" href="#Adding-endpoints"><span>Adding endpoints</span></a></li><li><a class="tocitem" href="#Defining-our-API"><span>Defining our API</span></a></li><li><a class="tocitem" href="#Demonstration"><span>Demonstration</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/tecosaur/RestClient.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/tecosaur/RestClient.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><h2 id="Basic-setup"><a class="docs-heading-anchor" href="#Basic-setup">Basic setup</a><a id="Basic-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-setup" title="Permalink"></a></h2><p>To demonstrate how this can simplify API wrapping, in this tutorial we&#39;ll implement a client for the <a href="https://deckofcardsapi.com/">Deck of Cards API</a>. For demonstration purposes, we&#39;ll just wrap part of the API.</p><p>Looking at the API documentation, we can see that</p><ul><li>The base URL is <code>https://deckofcardsapi.com/api/</code></li><li>Decks can be created at the <code>deck/new</code> API (optionally shuffled)</li><li>Operations on a deck occur at <code>deck/&lt;id&gt;/operation</code> endpoints</li></ul><p>That&#39;s it! To get started we&#39;ll create an blank package and call it &quot;DeckAPI&quot; (I did this in my temp directory).</p><pre><code class="nohighlight hljs">pkg&gt; generate DeckAPI
  Generating  project DeckAPI:
    DeckAPI/Project.toml
    DeckAPI/src/DeckAPI.jl</code></pre><p>Then, we activate the project and add <code>JSON3</code> and <code>RestClient</code> as dependencies.</p><pre><code class="nohighlight hljs">pkg&gt; activate DeckAPI

(DeckAPI) pkg&gt; add RestClient JSON3
    Updating `/tmp/DeckAPI/Project.toml`
  [d1389577] + RestClient v0.1.0
  [0f8b85d8] + JSON3 v1.14.1
    Updating `/tmp/DeckAPI/Manifest.toml`
  [...] ...</code></pre><p>Then we can navigate to <code>DeckAPI/src/DeckAPI.jl</code>, get rid of the default <code>greet() = print(&quot;Hello World!&quot;)</code>, and add</p><pre><code class="language-julia hljs">using RestClient, JSON3</code></pre><p>Now we&#39;re ready to get started implementing the API! To start with, we&#39;ll want to create a <code>RequestConfig</code> to hold the context in which we&#39;re calling the API. This just holds the base URL, a request lock, API access key (optional), and timeout value (optional). The <em>Deck of Cards</em> API is simple enough that we can set a single global <code>RequestConfig</code>, but in a more complex case we might define a utility function to create a <code>RequestConfig</code> based on user-provided parameters.</p><pre><code class="language-julia hljs">const DECK_CONFIG = RequestConfig(&quot;https://deckofcardsapi.com/api&quot;)</code></pre><p>That&#39;s all the setup needed, next we&#39;ll define types for the JSON structures that <em>Desk of Cards</em> can return.</p><h2 id="Defining-API-types"><a class="docs-heading-anchor" href="#Defining-API-types">Defining API types</a><a id="Defining-API-types-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-API-types" title="Permalink"></a></h2><p>Reading the documentation in order, we come across a few types we&#39;ll want to implement. First, there&#39;s the new deck object</p><pre><code class="language-json hljs">{
    &quot;success&quot;: true,
    &quot;deck_id&quot;: &quot;3p40paa87x90&quot;,
    &quot;shuffled&quot;: true,
    &quot;remaining&quot;: 52
}</code></pre><p>Thanks to the <a href="../api/#RestClient.@jsondef"><code>@jsondef</code></a> macro, this is merely a matter of</p><pre><code class="language-julia hljs">@jsondef struct Deck
    # success::Bool # I don&#39;t think we care about this?
    id.&quot;deck_id&quot;::String
    # shuffled::Bool # We should know this anyway?
    remaining::Int
end</code></pre><p>We can also draw cards, which look like this</p><pre><code class="language-julia hljs">@jsondef struct Card
    code::String
    # image # Not needed by us (at the moment)
    value::String
    suit::String
end</code></pre><p>Cards are given as a list in a certain response form, which gives us an opportunity to define a <a href="../api/#RestClient.ListResponse"><code>ListResponse</code></a> subtype.</p><pre><code class="language-julia hljs">@jsondef struct CardsResponse &lt;: ListResponse{Card}
    deck.&quot;deck_id&quot;::String
    remaining::Int
    cards::Vector{Card}
end</code></pre><p>Since we&#39;ve subtyped <code>ListResponse</code>, this will automagically be turned into a <a href="../api/#RestClient.List"><code>List</code></a> holding <code>cards</code>.</p><h2 id="Adding-endpoints"><a class="docs-heading-anchor" href="#Adding-endpoints">Adding endpoints</a><a id="Adding-endpoints-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-endpoints" title="Permalink"></a></h2><p>In <code>RestClient</code>, each endpoint is represented with a dedicated subtype of <a href="../api/#RestClient.AbstractEndpoint"><code>AbstractEndpoint</code></a>. Endpoints that provide a single value should subtype <a href="../api/#RestClient.SingleEndpoint"><code>SingleEndpoint</code></a>, while endpoints that provide multiple values should subtype <a href="../api/#RestClient.ListEndpoint"><code>ListEndpoint</code></a>.</p><p>While we could define the structs and the interface methods separately, we can conveniently combine these steps with the <a href="../api/#RestClient.@endpoint"><code>@endpoint</code></a> macro.</p><p>Let&#39;s start off with deck creation.</p><pre><code class="language-julia hljs">@endpoint struct NewDeckEndpoint &lt;: SingleEndpoint
    &quot;deck/new{ifelse(self.shuffle, \&quot;/shuffle\&quot;, \&quot;\&quot;)}?deck_count={count}&quot; -&gt; Deck
    count::Int
    shuffle::Bool
end</code></pre><p>We can also shuffle decks.</p><pre><code class="language-julia hljs">@endpoint struct ShuffleEndpoint &lt;: SingleEndpoint
    &quot;deck/{deck}/shuffle?{remaining}&quot; -&gt; Deck
    deck::String
    remaining::Bool
end</code></pre><p>Now let&#39;s draw some cards.</p><pre><code class="language-julia hljs">@endpoint struct DrawEndpoint &lt;: ListEndpoint
    &quot;deck/{deck}/draw?{count}&quot; -&gt; CardsResponse
    deck::String
    count::Int
end</code></pre><p>Cards can also be returned to the deck.</p><pre><code class="language-julia hljs">@endpoint struct CardReturnEndpoint &lt;: SingleEndpoint
    &quot;deck/{deck}/return&quot; -&gt; Deck
    deck::String
    cards::Union{Nothing, Vector{Card}}
end

function RestClient.parameters(ret::CardReturnEndpoint)
    if isnothing(ret.cards)
        Pair{String, String}[]
    else
        [&quot;cards&quot; =&gt; join(map(c -&gt; c.code, ret.cards), &quot;,&quot;)]
    end
end</code></pre><h2 id="Defining-our-API"><a class="docs-heading-anchor" href="#Defining-our-API">Defining our API</a><a id="Defining-our-API-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-our-API" title="Permalink"></a></h2><p>Now we&#39;ve gone to the effort of defining all our types and endpoints, we just need to create the API for our package.</p><pre><code class="language-julia hljs">new(count::Int = 1; shuffled::Bool=false) =
    api_get(Request(DECK_CONFIG, NewDeckEndpoint(count, shuffled)))</code></pre><pre><code class="language-julia hljs">shuffle(deck::Deck, remaining::Bool=false) =
    api_get(Request(DECK_CONFIG, ShuffleEndpoint(deck.id, remaining)))</code></pre><pre><code class="language-julia hljs">draw(deck::Deck, count::Int=1) =
    api_get(Request(DECK_CONFIG, DrawEndpoint(deck.id, count)))</code></pre><pre><code class="language-julia hljs">putback(deck::Deck, cards::Union{Nothing, Vector{Card}} = nothing) =
    api_get(Request(DECK_CONFIG, CardReturnEndpoint(deck.id, cards)))

putback(cardlist::List{Cards}) = putback(cardlist.request.endpoint.deck, cardlist.items)</code></pre><h2 id="Demonstration"><a class="docs-heading-anchor" href="#Demonstration">Demonstration</a><a id="Demonstration-1"></a><a class="docs-heading-anchor-permalink" href="#Demonstration" title="Permalink"></a></h2><p>By starting Julia with the environment variable <code>JULIA_DEBUG=RestClient</code> set, we will see information on the requests sent and responses received. This helps us verify that everything is behaving as expected, and debug any failures or unexpected results.</p><pre><code class="language-julia-repl hljs">julia&gt; deck = DeckAPI.new()
┌ Debug:  GET  https://deckofcardsapi.com/api/deck/new?deck_count=1
└ @ RestClient
┌ Debug:  200  80 bytes (saved to /tmp/api-get.dump) from https://deckofcardsapi.com/api/deck/new?deck_count=1
└ @ RestClient
DeckAPI.Deck(id=&quot;01n3ezer3rly&quot;, remaining=52)

julia&gt; cards = DeckAPI.draw(deck, 5)
┌ Debug:  GET  https://deckofcardsapi.com/api/deck/01n3ezer3rly/draw?count=5
└ @ RestClient
┌ Debug:  200  1.181 KiB (saved to /tmp/api-get.dump) from https://deckofcardsapi.com/api/deck/01n3ezer3rly/draw?count=5
└ @ RestClient
RestClient.List{DeckAPI.Card} holding 5 items:
  • Card(code=&quot;AS&quot;, value=&quot;ACE&quot;, suit=&quot;SPADES&quot;)
  • Card(code=&quot;2S&quot;, value=&quot;2&quot;, suit=&quot;SPADES&quot;)
  • Card(code=&quot;3S&quot;, value=&quot;3&quot;, suit=&quot;SPADES&quot;)
  • Card(code=&quot;4S&quot;, value=&quot;4&quot;, suit=&quot;SPADES&quot;)
  • Card(code=&quot;5S&quot;, value=&quot;5&quot;, suit=&quot;SPADES&quot;)

julia&gt; DeckAPI.putback(cards)
┌ Debug:  GET  https://deckofcardsapi.com/api/deck/01n3ezer3rly/return?cards=AS%2C2S%2C3S%2C4S%2C5S
└ @ RestClient
┌ Debug:  200  61 bytes (saved to /tmp/api-get.dump) from https://deckofcardsapi.com/api/deck/01n3ezer3rly/return?cards=AS%2C2S%2C3S%2C4S%2C5S
└ @ RestClient
DeckAPI.Deck(id=&quot;01n3ezer3rly&quot;, remaining=52)

julia&gt; DeckAPI.shuffle(deck)
┌ Debug:  GET  https://deckofcardsapi.com/api/deck/01n3ezer3rly/shuffle?remaining=false
└ @ RestClient
┌ Debug:  200  79 bytes (saved to /tmp/api-get.dump) from https://deckofcardsapi.com/api/deck/01n3ezer3rly/shuffle?remaining=false
└ @ RestClient
DeckAPI.Deck(id=&quot;01n3ezer3rly&quot;, remaining=52)

julia&gt; cards = DeckAPI.draw(deck, 5)
┌ Debug:  GET  https://deckofcardsapi.com/api/deck/01n3ezer3rly/draw?count=5
└ @ RestClient
┌ Debug:  200  1.183 KiB (saved to /tmp/api-get.dump) from https://deckofcardsapi.com/api/deck/01n3ezer3rly/draw?count=5
└ @ RestClient
RestClient.List{DeckAPI.Card} holding 5 items:
  • Card(code=&quot;3C&quot;, value=&quot;3&quot;, suit=&quot;CLUBS&quot;)
  • Card(code=&quot;QC&quot;, value=&quot;QUEEN&quot;, suit=&quot;CLUBS&quot;)
  • Card(code=&quot;4S&quot;, value=&quot;4&quot;, suit=&quot;SPADES&quot;)
  • Card(code=&quot;2D&quot;, value=&quot;2&quot;, suit=&quot;DIAMONDS&quot;)
  • Card(code=&quot;3S&quot;, value=&quot;3&quot;, suit=&quot;SPADES&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Sunday 8 December 2024 08:28">Sunday 8 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
